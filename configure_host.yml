---
#first time ./ansible-playbook_wrapper configure_host.yml -u yourgenericaccount -Kk  -e "NAME_PROJECT=myproject"
#second time ./ansible-playbook_wrapper configure_host.yml -K  -e "NAME_PROJECT=myproject"

- hosts: "{{ NAME_PROJECT }}"
  gather_facts: false
  tasks:
  - name: install python 2
    raw: test -e /usr/bin/python || (apt -y update && apt install -y python-minimal)
    become: true

- hosts: "{{ NAME_PROJECT }}"
  roles:
  - {role: "install-kernel", tags: "kernel"}
  - {role: "configure-rsyslog", tags: "rsyslog"}
  - {role: "configure-hostname", tags: "configure-hostname"}
  - {role: "configure-ssh", tags: "configure-ssh"}
  - {role: "install-tools", tags: "install-tools"}
  - {role: "docker", tags: "install-docker"}
  - {role: "upgrade-packages", tags: "upgrade-packages"}
  - {role: "configure-ops-accounts", tags: "ops"}
  post_tasks:
  - name: Remove former ops users
    user: name="{{ item.name}}" groups="adm,sudo" shell="/bin/bash" home="/home/{{item.name}}" password="{{ item.password }}" state=absent
    with_items: '{{former_ops_users}}'
    become: yes
